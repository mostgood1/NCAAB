<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NCAAB Betting – Recommendations</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}" />
  <style>
    :root{ --bg:#0a0f1c; --card:#111931; --text:#f6f8ff; --muted:#b6c2df; --pill:#152042; --pill-br:#2a3a63; --accent:#9ec5ff }
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--text)}
    .container{max-width:1100px;margin:24px auto;padding:0 16px}
    h1{margin:0 0 8px 0;font-size:24px}
    .meta{color:var(--muted);font-size:12px;margin-bottom:14px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--pill-br);padding:8px 6px;font-size:13px}
    th{color:var(--muted);text-align:left}
    .pill{display:inline-block;background:var(--pill);border:1px solid var(--pill-br);border-radius:999px;padding:3px 8px;font-size:12px}
    a{color:var(--accent)}
    .rec-header{display:flex; align-items:center; gap:12px; margin-bottom:12px}
    .rec-header .spacer{flex:1}
    .pill.time-local{background:#12324e;border-color:#1d4d75;color:#f6f8ff;}
    .pill.time-local.rollover{background:#53257c;border-color:#6d36a5;color:#fff;}
  </style>
</head>
<body>
  <div class="container">
    <div class="rec-header">
      <h1>NCAAB – Recommendations</h1>
      <div class="spacer"></div>
      <a href="/">Cards</a>
      <button id="toggleContrast" class="pill" title="Toggle high contrast">High Contrast</button>
    </div>
    <div class="meta">{{ total_rows }} rows</div>
    {% if not rows %}
      <div class="meta">No picks generated. Use daily-run or make-picks CLI.</div>
    {% else %}
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Start (Local)</th>
            <th>Matchup</th>
            <th>Book</th>
            <th>Bet</th>
            <th>Line</th>
            <th>Price</th>
            <th>Pred Total</th>
            <th>Proj Home</th>
            <th>Proj Away</th>
            <th>Edge</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          {% set disp_date = r.display_date if r.display_date is defined and r.display_date else (r.date if r.date else '') %}
          {% set loc_time = r.start_time_local_venue if r.start_time_local_venue else (r.start_time_local if r.start_time_local else (r.start_time_display if r.start_time_display else '')) %}
          {% set tz_abbr = r.start_tz_abbr_venue if r.start_tz_abbr_venue else (r.start_tz_abbr if r.start_tz_abbr else '') %}
          {% set is_rollover = (r.display_date is defined and r.date is defined and r.display_date and r.date and r.display_date != r.date) %}
          <tr tabindex="0">
            <td>{{ disp_date }}</td>
            <td><span class="pill time-local{% if is_rollover %} rollover{% endif %}" data-rollover="{{ '1' if is_rollover else '0' }}">{{ loc_time }}{% if tz_abbr %} {{ tz_abbr }}{% endif %}</span></td>
            <td><strong>{{ r.home_team }}</strong> vs {{ r.away_team }}</td>
            <td>{{ r.book or '' }}</td>
            <td>{{ r.bet or '' }}</td>
            <td>{{ '%.1f' % r.line if r.line is not none else '' }}</td>
            <td>{{ r.price if r.price is not none else '' }}</td>
            <td>{{ '%.1f' % r.pred_total if r.pred_total is not none else '' }}</td>
            <td>{{ '%.1f' % r.proj_home if r.proj_home is not none else '' }}</td>
            <td>{{ '%.1f' % r.proj_away if r.proj_away is not none else '' }}</td>
            <td><span class="pill">{{ '%.1f' % r.edge if r.edge is not none else '' }}</span></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>
  <script>
    (function(){
      var btn = document.getElementById('toggleContrast');
      if(btn){
        btn.addEventListener('click', function(){
          document.documentElement.classList.toggle('high-contrast');
          try{ localStorage.setItem('highContrast', document.documentElement.classList.contains('high-contrast')?'1':'0'); }catch(e){}
        });
        try{ if(localStorage.getItem('highContrast')==='1'){ document.documentElement.classList.add('high-contrast'); } }catch(e){}
      }
    })();
  </script>
</body>
      function cleanupTable(){
        const rows = document.querySelectorAll('table tbody tr');
        rows.forEach(tr=>{
          tr.querySelectorAll('td').forEach(td=>{
            const txt = (td.textContent||'').trim().toLowerCase();
            if(txt==='nan' || txt==='-' || txt==='—'){
              td.textContent = '';
            }
          });
          const pill = tr.querySelector('.pill.time-local');
          if(pill){
            const disp = pill.getAttribute('data-display');
            const tz = pill.getAttribute('data-tz');
            if(disp){ pill.textContent = disp + (tz?(' '+tz):''); }
          }
        });
      }
      document.addEventListener('DOMContentLoaded', cleanupTable);
</html>
