<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NCAAB – Benchmarks</title>
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}" />
</head>
<body>
  <div class="container">
    <div class="row header">
      <h1>Benchmarks</h1>
      <div class="spacer"></div>
      <nav class="nav-links">
        <a href="/">Cards</a>
        <a href="/home">Dashboard</a>
      </nav>
    </div>
    {% if note %}<div class="card mb8"><div class="muted">{{ note }}</div></div>{% endif %}
    {% if summary %}
      <div class="card mb8">
        <details open>
          <summary class="pill">Summary</summary>
          <div class="muted m4v8">Range: {{ summary.start }} → {{ summary.end }} · Bets: {{ summary.total_bets }} · Hit: {{ '%.1f' % (summary.hit_rate * 100) }}% · PnL: {{ '%.2f' % summary.total_pnl }}{% if summary.mae_total is defined and summary.mae_total is not none %} · MAE Total: {{ '%.2f' % summary.mae_total }}{% endif %}</div>
        </details>
      </div>
    {% endif %}
    {% if daily_rows %}
      <div class="card">
        <details open>
          <summary class="pill">Daily</summary>
          <div class="diag-grid flex-row-wrap">
            {% for r in daily_rows %}
              <div class="pill small">{{ r.date }} · Bets {{ r.ou_bets or 0 }}+{{ r.ats_bets or 0 }} · Hits {{ r.ou_hits or 0 }}+{{ r.ats_hits or 0 }} · PnL {{ '%.2f' % (r.total_pnl or 0) }}{% if r.mae_total_mean is defined and r.mae_total_mean is not none %} · MAE {{ '%.2f' % r.mae_total_mean }}{% endif %}</div>
            {% endfor %}
          </div>
          {% if daily_rows|length > 1 %}
            <div class="mt4">
              <div class="muted">PnL Trend</div>
              <svg id="pnlSpark" width="520" height="80"></svg>
            </div>
            <script>
              (function(){
                var rows = {{ daily_rows|tojson }};
                var svg = document.getElementById('pnlSpark'); if(!svg||!rows||rows.length<2) return;
                var w=520,h=80,p=8;
                var xs = rows.map(function(r){ return r.total_pnl||0; });
                var min = Math.min.apply(null, xs), max = Math.max.apply(null, xs);
                var scaleX = function(i){ return p + i * ((w - 2*p) / (rows.length - 1)); };
                var scaleY = function(v){ if(max===min){ return h/2; } var t=(v-min)/(max-min); return h - (p + t*(h - 2*p)); };
                var path = '';
                rows.forEach(function(r,i){ var x=scaleX(i), y=scaleY(r.total_pnl||0); path += (i===0? 'M':'L') + x + ',' + y + ' '; });
                var line = document.createElementNS('http://www.w3.org/2000/svg','path');
                line.setAttribute('d', path.trim()); line.setAttribute('fill','none'); line.setAttribute('stroke','#1c7ed6'); line.setAttribute('stroke-width','2');
                svg.appendChild(line);
                // zero line
                var zeroY = scaleY(0);
                var z = document.createElementNS('http://www.w3.org/2000/svg','line');
                z.setAttribute('x1', p); z.setAttribute('x2', w-p); z.setAttribute('y1', zeroY); z.setAttribute('y2', zeroY);
                z.setAttribute('stroke','#555'); z.setAttribute('stroke-width','1'); z.setAttribute('stroke-dasharray','4,4');
                svg.appendChild(z);
              })();
            </script>
          {% endif %}
          {% if summary %}
            <div class="mt4">
              <a class="pill" href="/static/../outputs/backtest_daily.csv" download>Download CSV</a>
            </div>
          {% endif %}
        </details>
      </div>
    {% else %}
      <div class="card"><div class="muted">No backtest artifacts found.</div></div>
    {% endif %}
  </div>
</body>
</html>
